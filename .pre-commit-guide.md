# Pre-commit Setup and Usage

This project uses [pre-commit](https://pre-commit.com/) to maintain code quality and consistency. Pre-commit runs various automated checks before each commit to catch issues early.

## Installation

### For Development

If you're working on this project, install the development dependencies:

```bash
# Install with development dependencies
pip install -e ".[dev]"

# Or install pre-commit directly
pip install pre-commit
```

### Setting up Pre-commit Hooks

```bash
# Install pre-commit hooks (one-time setup)
pre-commit install

# This will run the hooks automatically on every commit
```

## Usage

### Automatic Checks

Once installed, pre-commit will automatically run on every `git commit`. If any checks fail, the commit will be blocked and you'll need to fix the issues.

### Manual Execution

```bash
# Run pre-commit on all files
pre-commit run --all-files

# Run pre-commit on staged files only
pre-commit run

# Run a specific hook
pre-commit run black
pre-commit run flake8
```

### Common Workflows

```bash
# Before committing changes
git add .
pre-commit run --all-files  # Check everything
git commit -m "Your commit message"

# Fix issues automatically (some hooks auto-fix)
pre-commit run --all-files
git add .  # Add the auto-fixed files
git commit -m "Your commit message"
```

## What Pre-commit Checks

Our pre-commit configuration includes:

### Code Quality
- **Black**: Python code formatting
- **isort**: Import statement organization
- **flake8**: Python linting (syntax errors, style issues)

### General Checks
- **Trailing whitespace**: Removes trailing spaces
- **End of file**: Ensures files end with newline
- **Large files**: Prevents committing large files
- **Python AST**: Validates Python syntax
- **Merge conflicts**: Detects unresolved merge conflicts

### Content Validation
- **YAML/TOML/JSON**: Validates configuration file syntax
- **Codespell**: Catches common typos

## Configuration

The pre-commit configuration is in `.pre-commit-config.yaml`. Key settings:

- **Relaxed for demo code**: Test files and examples have reduced strictness
- **Auto-formatting**: Black and isort automatically fix formatting issues
- **Excludes**: `.sxt` files and VS Code configs are excluded from some checks

## Troubleshooting

### Pre-commit is failing
```bash
# Update pre-commit hooks to latest versions
pre-commit autoupdate

# Clear cache and reinstall
pre-commit clean
pre-commit install
```

### Skip pre-commit for urgent commits
```bash
# Skip pre-commit hooks (use sparingly!)
git commit --no-verify -m "Emergency fix"
```

### VS Code Integration

Pre-commit works great with VS Code:

1. Install the "pre-commit" VS Code extension
2. Configure VS Code to run black/isort on save
3. See issues highlighted in real-time

## Benefits

- **Consistent code style** across all contributors
- **Early bug detection** before code review
- **Automated formatting** saves manual work
- **Reduced review friction** by catching style issues automatically
- **Better code quality** through automated linting

## Similar to CuPy Project

This configuration is inspired by the [CuPy project](https://github.com/cupy/cupy), which uses similar pre-commit hooks for maintaining high code quality across a large Python codebase.
